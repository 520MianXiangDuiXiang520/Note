# TCP 可靠传输的实现

TCP 协议位于 TCP/IP 协议栈的第四层——运输层，负责特供一种基于连接的可靠服务，它承接上面应用层的数据，并将其封装为 TCP 段，然后传递给下层的网络层，但网络层的 IP 协议只提供尽最大努利的服务，因此 TCP 协议必须通过一些机制来保证服务的可靠性。

<!-- more -->

## 什么样的服务是可靠的

理想的传输条件包括下面两个特点：

1. 传输信道不产生任何差错。
2. 不管发送方以多快的方式发送数据，接收方总是来得及处理接受到的数据。

只要保证了上面两点，这个传输就必然是可靠的，但事实情况是网络环境复杂，在传输中一定会产生差错，并且会话双方对数据的处理能力往往不同，第二点也就无法保障了，所以为了保障可靠传输，就要求接收方能在没有接收到数据或接受到错误数据后能通知发送发重发出现差错的数据，同时，还要要求接收方在来不及处理接受到的数据时，及时告诉发送发降低发送数据的速度。

## 停止等待协议

所谓 **停止等待** 就是发送方在发送完一个分组数据后，就停下来等待对方的确认信息，得到确认后再发送下一个分组，如果在一段时间内没有得到确认，就要重新发送刚才的数据。

在正常没有差错的情况下，发送方发送完数据，接收方接受到数据并向发送方发送确认信息，发送方接受到确认信息后发送下一个分组。

如果在传输过程中出现了差错，这些差错包括：

1. 发送方发送的数据丢失或出错
2. 接收方发出的确认信息丢失或出错



