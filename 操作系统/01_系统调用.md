# 系统调用

## 什么是内核态和用户态

1. 操作系统启动时会初始化硬件设备，其中会在内存中划分内核段和用户段；
2. 内核程序位于内核段；
3. 内核态和用户态是进程的两种状态，用户态只能操作用户段的数据，内核态可以操作所有数据。
4. 用户开启的所有进程都处于用户态。

## 为什么区分内核态和用户态

为了安全，防止用户程序随便修改或窃取内核中一些重要的数据（root 密码， 其他用户的数据）

## 如何区分内核态和用户态

由硬件比较特权级区分，特权级从 0 到 3，数字越小，权限越大，内核态特权级为 0， 用户态特权级为 3：

![](https://cdn.jsdelivr.net/gh/520MianXiangDuiXiang520/cdn/img/1604060452308-1604060452302.png)

* DPL： 目标特权级
* CPL： 当前特权级

OS 初始化时，内核态 DPL 就会被初始化为 0， 执行某条指令时，会由硬件检查 CPL 和 DPL， 如果 CPL 大于 DPL, 就会阻止。

## 用户程序如何使用底层硬件

只有内核程序才可以操作底层硬件，但内核程序位于内核段，普通用户程序无法访问，为此，内核暴露了一些方法，称为系统调用，用户程序可以通过系统调用访问内核。

系统调用PLD的实质是中断（`int 0x80`）,中断是进入内核的唯一办法。

系统调用 DPL = 3， CPL = 0