### 协议分层与OSI参考模型
<!--more-->
#### 1.协议的分层
前面说过，ISO 制定了 OSI 参考模型，虽然没有广泛推广使用，但在制定 OSI 之前作为其指导方针的 OSI参考模型却被常用在网络协议的制定当中，这一模型将通信协议中必要的功能分成了七层，通过这些分层，使得那些比较复杂的协议简单化

在这一模型中，每个分层都接受由他下一层所提供的服务，并且也负责为自己的上一层提供特点服务，上下层之间交互所遵循的约定叫做 **“接口”** ，同一层之间交互所遵循的约定叫做 **“协议”** 

![01](https://upload-images.jianshu.io/upload_images/4879291-c488f4157dff67fb.png)

* 优点： 大大提高系统拓展性和灵活性，细分通信功能，易于实现每个分层的协议，并界定各个分层的责任和义务。
* 缺点： 过分模块化，使处理变得沉重，每个模块间不得不实现相似的处理逻辑 

> 引用自 CSDN [博客](https://img-blog.csdn.net/20140729145853939?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWVsYW5nanVlcWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
> 通过对话理解分层;关于协议的分层，我们再以A与C的对话(见上一节)为例简单说明一下。在此，我们只考虑语言层和通信设备层这两个分层的情况。首先，以电话聊天为例，见下图，上半部分中的A与C两个人正在通过电话 (通信设备）用汉语（语言协议）聊天。我们详细分析一下这张图。
> ![02](https://img-blog.csdn.net/20140729145853939?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWVsYW5nanVlcWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
> 表面上看A跟C是在用汉语直接对话，但实际上A与C都是在通过电话机的听筒听取声音，都在对着麦克风说话。想象一下如果有一个素未见过电话机的人见到这个场景会怎么想？恐怕他一定会以为A和C在跟电话机聊天吧。其实在这个图中，他们所用的语言协议作为麦克风的音频输入，在通信设备层被转换为电波信号传送出去了。传送到对方的电话机后，又被通信设备层转换为音频输出，传递给了对方。因此，A与C其实是利用电话机之间通过音频转化声音的接口实现了对话。
>     通常人们会觉得拿起电话与人通话，其实就好像是直接在跟对方对话，然而如果仔细分析，在整个过程中实际上是电话机在做中介，这是不可否认的。如果A的电话 机所传出的电子信号并未能转换成与C的电话机相同频率的声音，那会如何？这就如 同A的电话机与C的电话机的协议互不相同。C听到声音后可能会觉得自己不是在跟 A而是在跟其他人说话。频率若是相去甚远，C更有可能会觉得自己听到的不是汉语。
那么如果我们假定语言层相同而改变了通信设备层，情况会如何？例如，将 电话机改为无线电。通信设备层如果改用无线电，那么就得学会使用无线电的方 法。由于语言层仍然在使用汉语协议，因此使用者可以完全和以往打电话时一样 正常通话（上图左下部分）。
那么，如果通信设备层使用电话机，而语言层改为英语的话情况又会如何？ 很显然，电话机本身不会受限于使用者使用的语言。因此，这种情况与使用汉语 通话时完全一样，依然可以实现通话（上图右下部分）。
   到此为止，读者可能会觉得这些都是再简单不过的、理所当然的事。在此仅举出简单的例子，权作对协议分层及其便利性的一个解释，以加深对分层协议的理解。

#### 2.OSI参考模型

|   | OSI参考模型  |   |
|----|---|---|
|   |分层名称|功能|
|7|   应用层 |针对特点应用的协议，如电子邮件对应电子邮件协议，文件传输对应文件传输协议|
|6|表示层|实现设备固有数据格式和网络标准数据格式的转换，比如将接收到的图像文字声音等转换为网络数字格式|
|5|会话层|负责建立和断开通信连接，管理传输层以下分层|
|4|传输层|管理两个节点之间的数据传输，负责可靠传输（确保数据被可靠的传输到目标地址）|
|3|网络层|负责地址管理与路由选择（判断经过那个路由器传递到目标地址）|
|2|数据链路层|互联设备之间传送和识别数据帧（将数据组合成数据块，称为帧,控制帧在物理信道上的传输，处理传输差错，调节传输速率，）|
|1|物理层|以 0 1 代表电压的高低，灯光的闪灭，界定连接器与网线的规格等|

* OSI协议与OSI参考模型：
OSI参考模型将通信功能划分为七个分层，OSI协议是以此参考模型为基础，界定了每个阶层的协议与每个阶层之间接口的相关标准，遵循OSI协议的产品叫做OSI产品，他们所遵循的通信叫做OSI通信，两者之间指代意义不同，请勿混淆。
#### 3.通信的实现
##### 3.1 应用层
根据应用层的功能，他是针对特点应用的协议，如电子邮件对应电子邮件协议，文件传输对应文件传输协议，以电子邮件为例，如果狗蛋要指定给翠花发一封电子邮件，内容是 “吃了吗？”，当狗蛋按下发送的那一刻起，就进入了引用层协议的处理，该协议（电子邮件协议）会在要传输的数据前端加一个首部，标明邮件内容为“吃了吗？”收件人为翠花，这一附加了首部信息的数据传输给翠花后，由翠花的主机分析数据首部和数据正文，并保存到闪存，硬盘等设备中进行相应处理，最终获取邮件内容，如果翠花由于某些原因无法接受邮件，则会返回一个错误给狗蛋，这也属于引用层需要解决的问题。
##### 3.2 表示层
以打电话为例，如果狗蛋给翠花打电话，狗蛋用湖南方言，翠花是四川人，这时翠花就无法理狗蛋在说啥了，要解决这个问题，要么就是同意使用普通话，要么就是找一个懂湖南话和四川话的人做翻译，在网络世界中，各种终端就类似于方言，显然让全世界所有人使用同一款电子邮件软件是不太可能的，为了实现正常的数据传输，表示层就派上了用场，表示层就充当了这个翻译的功能，他把“某个计算机特定的数据格式”转换成“网络通用的标准数据格式”后再发送出去，接收端主机接受到这些数据后再将这些标准数据格式转换为“该计算机特定的数据格式”，然后在做相应的处理，以电子邮件为例，一句“吃了吗？”也有很多的编码方式，如熟悉的 GBK ， UTF-8 ISO8895-1等，表示层与表示层之间为了识别编码，也会在数据上添加首部信息，再交给下一层去处理。
##### 3.3 会话层
为了高效的进行数据交互，会话层也像应用层和表示层那样，在其收到的数据前端怎加首部信息和标签，再转发给下一层，这些标签中，记录着数据传输的顺序信息，
##### 3.4 传输层
主机A确保与主机B之间的通信并准备发送数据，这一过程称为“建立连接”，有了这个连接，主机A就可以发送邮件到主机B中，并由主机B的邮件处理程序获得最终数据，当通信传输结束后，还有必要断开连接
**注意：** 会话层只是决定建立连接和断开连接的时机，具体实现连接的建立和断开是由传输层完成的。
传输层一方面在两个主机之间建立逻辑上的通信连接，另一方面，还要在两台计算机间确认，数据是否完整达到目标地址，如果没有到达，它会负责重发。
为了确保可靠性，这一层也会为要传输的数据附加首部以识别这一分层的数据，然而，实际上将数据传输给对端的处理是由网络层完成的。
##### 3.5 网络层
网络层的作用是在网络与网络相互连接的环境中，将数据由发送端主机发送到接收端主机，在实际发送过程中，目标地址非常重要，这个地址是进行通信的网络中唯一指定的序号，只要由这个地址，就可以在千千万万个计算机中找到目标主机，基于这个地址，就可以在网络层进行数据表的发送处理。
* 网络层和传输层的关系
  网络层有时不能保证数据的可达性，但可以由传输层负责提供 “正确传输数据的处理” 。TCP/IP协议中，传输层和网络层相互协作，以确保数据表能被传输到世界各地，实现可靠传输。
##### 3.6 数据链路层，物理层
通信传输实际上是通过物理的传输介质实现的，数据链路层的作用就是在这些通过传输介质互联的设备之间进行数据处理。
物理层中，将数据的 0,1 转换为电压和脉冲光传输给物理的传输介质，而相互直连的设备之间使用地址实现传输，这种地址称为 MAC 地址，目的是为了识别连接到同一传输介质上的设备，因此，在这一分层中，将 包含MAC地址信息的首部附加到从网络层转发过来的数据上，再将其发送到网络。
网络层与数据链路层都是基于目标地址将数据发送给接收端的，但是，网络层负责将整个数据发送到目标地址，而数据链路层只负责发送某个分段内的数据